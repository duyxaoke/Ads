var $localstorage=function(n){return{set:function(t,i){n.localStorage[t]=i},get:function(t,i){return n.localStorage[t]||i},setObject:function(t,i){n.localStorage[t]=JSON.stringify(i)},getObject:function(t){try{var i=n.localStorage[t];if(i)return JSON.parse(i||"{}")}catch(r){return JSON.parse("{}")}},remove:function(t){n.localStorage.removeItem(t)},clearAll:function(){n.localStorage.clear()}}},CommonFactory,UtilFactory,DataFactory;$localstorage.$inject=["$window"];CommonFactory=function(n,t,i,r,u,f){var e={};return e.CodeStep={Status:"",StatusCode:0,ErrorStep:"",Message:"",ErrorMessage:"",Data:""},e.JsonStatusCode={Success:"Success",Error:"Error",Warning:"Warning",Info:"Info"},e.WriteLog=function(n,t){MasterData.APIDebug&&console.log(n,JSON.stringify(t))},e.WriteLogServerError=function(n,t,i){i||(i=UtilJS.guid().replace(/-/g,""));t=t?t+"/n/n":"";let r=t+JSON.stringify({message:n.message,stack:n.stack});e.WriteLogServer(r,i)},e.WriteLogServer=function(t,i){var u={type:"APIHelper",data:t,url:window.location.href},r={method:"POST",url:"/ClientLogs/consolescript",headers:{Accept:"application/json",UserID:n.UserPricinpal.Username},data:u};i!=undefined&&i!=""&&(r.headers.ConcungContextID=i);f(r).then(function(){})},e.PostDataAjax=function(n,t,u,f,o,s){try{s||(s=6e4);$.ajax({url:n,type:"POST",dataType:"json",data:t,beforeSend:u,success:function(n){i(function(){f(n)})},error:function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else r.Alert.RequestError(n),i(function(){o(n)})},complete:function(){}}).always(function(){})}catch(h){console.log("CommonFactory.PostDataAjax() error :"+h)}},e.GetDataAjax=function(n,t,u,f,o,s){try{s||(s=6e4);$.ajax({url:n,type:"GET",dataType:"json",data:t,beforeSend:u,success:function(n){i(function(){f(n)})},error:function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else r.Alert.RequestError(n),i(function(){o(n)})},complete:function(){}}).always(function(){})}catch(h){console.log("CommonFactory.PostDataAjax() error :"+h)}},e.PostDataAjaxAsync=function(n,t,u,f,o,s){try{s||(s=6e4);$.ajax({url:n,type:"POST",dataType:"json",data:t,beforeSend:u,async:!1,success:function(n){f(n)},error:function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else r.Alert.RequestError(n),i(function(){o(n)})},complete:function(){}}).always(function(){})}catch(h){console.log("CommonFactory.PostDataAjaxAsync() error :"+h)}},e.PostPromise=function(n,t){var i=u.defer();return f({method:"POST",url:n,data:t}).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise},e.GetPromise=function(n,t){var i=u.defer();return f({method:"GET",url:n,params:t}).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise},e.PostMethod=function(n,i,r){r&&r.CacheKeyClient&&t.remove(r.CacheKeyClient);let o=u.defer();var s={method:"POST",url:n,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest",TabBrowserKey:MasterData.TabBrowserKey},data:i};return e.WriteLog(n,i),f(s).then(function(n){o.resolve(n.data)},function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else n.objCodeStep={},n.objCodeStep.Status=e.JsonStatusCode.Error,n.objCodeStep.Message=e.StatusCodeMessage(n.status),o.reject(n)}),o.promise},e.GetMethod=function(n,i,r){r&&r.CacheKeyClient&&t.remove(r.CacheKeyClient);let o=u.defer();var s={method:"GET",url:n,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},data:i};return e.WriteLog(n,i),f(s).then(function(n){o.resolve(n.data)},function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else n.objCodeStep={},n.objCodeStep.Status=e.JsonStatusCode.Error,n.objCodeStep.Message=e.StatusCodeMessage(n.status),o.reject(n)}),o.promise},e.StatusCodeMessage=function(n){var t="";switch(n){case 400:t="Lỗi dữ liệu không hợp lệ";break;case 401:t="Phiên làm việc đã hết hạn, vui lòng đăng nhập lại.";break;case 403:t="Bạn không có quyền thực hiện thao tác này.";break;case 404:t="URL action không chính xác";break;case 405:t="Phương thức không được chấp nhận";break;case 500:t="Lỗi hệ thống";break;case 502:t="Đường truyền kém";break;case 503:t="Dịch vụ không hợp lệ";break;case 504:t="Hết thời gian chờ";break;case 440:t="Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại";break;default:t="Lỗi chưa xác định"}return t},e.ConfirmRedirectLogin=function(t){if(i(()=>{UtilJS.Loading.Hide()},500),!n.IsShowConfirmRedirectLogin){n.IsShowConfirmRedirectLogin=!0;let r="Phiên đăng nhập hết hạn, vui lòng bấm đồng ý để đăng nhập lại";t!==undefined&&t.Message&&(r=t.Message);$.confirm({title:"Thông báo!",content:r,buttons:{formSubmit:{text:'<i class="fa fa-check-circle"><\/i> Đồng ý',btnClass:"btn cc-btn-style cc-btn-color-blue",action:function(){n.IsShowConfirmRedirectLogin=!1;UtilJS.openReLogin()}},formSubmit2:{text:"Hủy",btnClass:"btn cc-btn-style",action:function(){n.IsShowConfirmRedirectLogin=!1}}}})}},e};CommonFactory.$inject=["$rootScope","$localstorage","$timeout","UtilFactory","$q","$http"];UtilFactory=function(n,t,i){var r={};return r.RoleEnum=Object.freeze({IT:[3147,3193],KT:[3172,3202,3203]}),r.CheckInRole=function(){let t=n.UserPricinpal.RoleIDs,i=_.find(t,n=>r.RoleEnum.IT.includes(n)||r.RoleEnum.KT.includes(n));return i?!0:!1},r.TypeViewEnum=Object.freeze({NganhHang:{Value:1,Text:"Ngành hàng"},SanPham:{Value:2,Text:"Sản phẩm"},KhachHang:{Value:3,Text:"Khách hàng"}}),r.DataTypeView=function(n){let t=[];var i=Object.getOwnPropertyNames(r.TypeViewEnum);return i.forEach(n=>{let i={};i.ID=r.TypeViewEnum[n].Value;i.Name=r.TypeViewEnum[n].Text;t.push(i)}),n&&n.length>0&&(t=t.filter(t=>!n.includes(t.ID))),t},r.RequiredDataTypeView=function(n){var t=angular.element(document.getElementById("ddlUserProductCategory")).scope();n==r.TypeViewEnum.SanPham.Value?(t.myroot.IsShowProduct=!0,t.myroot.ddlUserProductCategory.IsDisableOpenTree=!0,t.myroot.IsShowCustomer=!1,t.myroot.ddlUserProductCategory.API.DeselectAll(),t.myroot.PID=null,t.myroot.ProductID=null,t.myroot.ProductName=null,t.myroot.CustomerID=null,t.myroot.CustomerName=null):n==r.TypeViewEnum.KhachHang.Value?(t.myroot.IsShowCustomer=!0,t.myroot.ddlUserProductCategory.IsDisableOpenTree=!0,t.myroot.IsShowProduct=!1,t.myroot.ddlUserProductCategory.API.DeselectAll(),t.myroot.PID=null,t.myroot.ProductID=null,t.myroot.ProductName=null,t.myroot.CustomerID=null,t.myroot.CustomerName=null):(t.myroot.ddlUserProductCategory.IsDisableOpenTree=!1,t.myroot.IsShowProduct=!1,t.myroot.IsShowCustomer=!1,t.myroot.ddlUserProductCategory.API.DeselectAll(),t.myroot.PID=null,t.myroot.ProductID=null,t.myroot.ProductName=null,t.myroot.CustomerID=null,t.myroot.CustomerName=null)},r.PrepareData=function(n,t){let i={};if(i.CategoryIDs=[],i.PID=-2,i.CustomerID=-2,n==r.TypeViewEnum.NganhHang.Value){if(t.CategoryIDs!==undefined&&t.CategoryIDs.length==0)return jAlert.Warning("Vui lòng chọn ngành hàng","Thông báo"),!1;t.hasOwnProperty("PID")&&(t.PID=i.PID);t.hasOwnProperty("ProductID")&&(t.ProductID=i.PID);t.hasOwnProperty("CustomerID")&&(t.CustomerID=i.CustomerID)}if(n==r.TypeViewEnum.SanPham.Value){if(t.PID!==undefined&&!t.PID||t.ProductID!==undefined&&!t.ProductID)return jAlert.Warning("Vui lòng chọn sản phẩm","Thông báo"),!1;t.hasOwnProperty("CategoryIDs")&&(t.CategoryIDs=i.CategoryIDs);t.hasOwnProperty("CustomerID")&&(t.CustomerID=i.CustomerID)}if(n==r.TypeViewEnum.KhachHang.Value){if(t.CustomerID!==undefined&&!t.CustomerID)return jAlert.Warning("Vui lòng chọn khách hàng","Thông báo"),!1;t.hasOwnProperty("CategoryIDs")&&(t.CategoryIDs=i.CategoryIDs);t.hasOwnProperty("PID")&&(t.PID=i.PID);t.hasOwnProperty("ProductID")&&(t.ProductID=i.PID)}return t},r.sortBy=function(){var t=Object.prototype.toString,i=function(n){return n},n=function(n){var t=n!=null&&typeof n=="object",i=t&&this.prop in n;return this.parser(i?n[this.prop]:n)};return function(r,u){return(r instanceof Array&&r.length)?(t.call(u)!=="[object Object]"&&(u={}),typeof u.parser!="function"&&(u.parser=i),u.desc=!u.desc?1:-1,r.sort(function(t,i){return t=n.call(u,t),i=n.call(u,i),u.desc*(t<i?-1:+(t>i))})):[]}}(),r.ParseJsonDate=function(n){return new Date(parseInt(n.replace("/Date(","")))},r.GetDateString=function(n,t){var i=n==undefined?new Date:n,r;return i.setDate(i.getDate()),r=i.toISOString().slice(0,10).replace(/-/g,""),(t=="yyyyMM"||t=="yyyymm")&&(i.setMonth(i.getMonth()-1),r=i.toISOString().slice(0,8).replace(/-/g,"")),r},r.GetDateStringByValue=function(n,t){return n||r.GetDateString(t),t=="yyyyMM"||t=="yyyymm"?n.replace(/(\d\d)\/(\d{4})/,"$2$1"):n.replace(/(\d\d)\/(\d\d)\/(\d{4})/,"$3$2$1")},r.FormatDateTime=function(n,t){var r,i,u;return(n=n.toString(),r=n.substring(2,4),i=n.substring(4,6),t)?(u=n.substring(6,8),u+"."+i):i+"."+r},r.FormatDateTimeFull=function(n){n=n.toString();var t=n.substring(0,4),i=n.substring(4,6),r=n.substring(6,8);return r+"/"+i+"/"+t},r.FormatMonthYear=function(n){var t=n.toString().substr(0,4),i=n.toString().substr(4,2);return i+"/"+t},r.WaitingLoadDirective=function(n){clearInterval(r.myTimer);let t=i.defer();return r.myTimer=setInterval(()=>{n.filter(n=>n.IsReady==!0).length==n.length&&(clearInterval(r.myTimer),t.resolve())},100),t.promise},r.InitArrayNoIndex=function(n){for(var i=[],t=1;t<n;t++)i.push(t);return i},r.String={},r.String.IsNullOrEmpty=function(n){return!n||n==null?!0:!1},r.String.IsContain=function(n,t){return r.String.IsNullOrEmpty(n)?!1:r.String.IsNullOrEmpty(t)?!0:n.indexOf(t)<0?!1:!0},r.Alert={},r.Alert.RequestError=function(n){console.log(n);var t="";switch(n.status){case 400:t="Lỗi dữ liệu không hợp lệ";break;case 401:t="Phiên làm việc đã hết hạn, vui lòng đăng nhập lại.";break;case 403:t="Bạn không có quyền thực hiện thao tác này.";break;case 404:t="URL action không chính xác";break;case 405:t="Phương thức không được chấp nhận";break;case 500:t="Lỗi hệ thống";break;case 502:t="Đường truyền kém";break;case 503:t="Dịch vụ không hợp lệ";break;case 504:t="Hết thời gian chờ";break;case 440:t="Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại";break;default:t="Lỗi chưa xác định"}jAlert.Error(t,"Thông báo")},r};UtilFactory.$inject=["$rootScope","$timeout","$q"];DataFactory=function(n,t,i,r,u,f,e){var o={};return o.DepartmentTree_Read=function(){let n=u.defer();return o.Department_Get().then(function(t){let i={};i.Data=_.map(t.Data,_.clone);i.Data.forEach(n=>{n.id=n.DepartmentID,n.text=n.DepartmentName,n.parent=n.ParentID,n.ParentID==0&&(n.parent="#"),n.id==n.parent&&console.log("lỗi: id = parent",n)});n.resolve(i)}).catch(function(t){n.reject(t)}),n.promise},o.Department_Get=function(){let n=ApiEndPoint.DepartmentResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Department})},o.Suppliers_Get=function(){let n=ApiEndPoint.SupplierResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Supplier})},o.CustomerMemberTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.CustomerMemberType})},o.StoreTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.StoreType})},o.IvenCenterStockTypes_Get=function(){let n=ApiEndPoint.IvenCenterStockTypesResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.IvenCenterStockType})},o.PaymentTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PaymentType})},o.VoucherTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.VoucherType})},o.VoucherGroups_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.VoucherGroup})},o.Stores_Get=function(){let n=ApiEndPoint.StoreResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Store})},o.InvoiceStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.InvoiceStatus})},o.PayFormStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PayFormStatus})},o.PayFormTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PayFormType})},o.VoucherBanks_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.VoucherBank})},o.OutputTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.OutputType})},o.OutputTypes_ByUserLogin=function(){let n=u.defer();return e.PostMethod("/OutputTypes/GetByUser/").then(t=>t.StatusCode==204?(t.Is204=!0,t.Data=[],n.resolve(t)):n.resolve(t)).catch(t=>(t.Data=[],n.resolve(t))),n.promise},o.OutputGroups_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.OutputGroup})},o.UserStores_Get=function(){let n=u.defer();return e.PostMethod("/Users/GetStore/").then(t=>t.StatusCode==204?(t.Is204=!0,t.Data=[],n.resolve(t)):n.resolve(t)).catch(t=>n.reject(t)),n.promise},o.Users_Get=()=>{let n=u.defer();return e.PostMethod("/Users/List/").then(function(t){return t.objCodeStep.Status==="Warning"&&n.reject(t),n.resolve(t)}).catch(function(t){n.reject(t)}),n.promise},o.PurcOrderStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PurcOrderStatus})},o.InputGroups_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.InputGroup})},o.InputTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.InputType})},o.SalaryShifts_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.SalaryShift})},o.PromotionTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PromotionType})},o.StoreChangeTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.StoreChangeType})},o.TransportTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.TransportType})},o.Shelfs_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.Shelf})},o.StoreGroup_Get=function(n){let i=n.filter(n=>n.ParentStoreGroupID===0&&n.StoreID===0),t=[];n.filter(n=>{_.find(t,t=>t.StoreGroupID===n.StoreGroupID&&t.ParentStoreGroupID===n.ParentStoreGroupID)||t.push({StoreGroupID:n.StoreGroupID,StoreGroupName:n.StoreGroupName,ParentStoreGroupID:n.ParentStoreGroupID})});return i.filter(n=>{t.push({StoreGroupID:n.StoreGroupID,StoreGroupName:n.StoreGroupName,ParentStoreGroupID:n.ParentStoreGroupID,DeliveryDayNumber:n.DeliveryDayNumber,IsActived:n.IsActived})}),t},o.StoreGroup_ReadAll=function(){let n=u.defer();return e.PostMethod("/StoreGroups/List/").then(function(t){return t.objCodeStep.Status==="Warning"&&n.reject(t),n.resolve(t)}).catch(function(t){n.reject(t)}),n.promise},o.StoreGroupTree_Read=function(){let n=u.defer();return o.StoreGroup_ReadAll().then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)}),n.promise},o.StoreSizes_Get=function(){let n=ApiEndPoint.StoreSizeResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.StoreSize})},o.Provinces_Get=function(){let n=ApiEndPoint.ProvinceResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Province})},o.Districts_Get=function(){let n=ApiEndPoint.DistrictResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.District})},o.Areas_Get=function(){let n=ApiEndPoint.AreasResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Areas})},o.PriceRegions_Get=function(){let n=ApiEndPoint.PriceRegionResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.PriceRegions})},o.ProductCategoriesTree_Read=function(n){let t=u.defer();return n?(o.ProductCategories_Get().then(n=>{let i=n.Data;return i.forEach(n=>{n.id=n.CategoryID,n.text=n.CategoryName,n.parent=n.ParentCategoryID==0?"#":n.ParentCategoryID}),t.resolve(n)}).catch(n=>{UtilJS.Loading.Hide();throw n;}),t.promise):(u.all({res1:o.ProductCategories_Get(),res2:o.ProductCategories_ByUserLogin()}).then(n=>{let i=n.res1.Data,u=n.res2.Data;i.forEach(n=>{n.id=n.CategoryID,n.text=n.CategoryName,n.parent=n.ParentCategoryID==0?"#":n.ParentCategoryID,n.IsHide=!0});var r=[];u.filter(n=>r.push(n.CategoryID));i.forEach(n=>{_.contains(r,n.id)&&(n.IsHide=!1,o.GetParentsByID(i,n.parent))});let f=i.filter(n=>!n.IsHide);return n.res2.Data=f,t.resolve(n.res2)}).catch(n=>{UtilJS.Loading.Hide();throw n;}),t.promise)},o.GetParentsByID=function(n,t){if(t!="#"){var i=_.find(n,n=>n.id===t);i&&i.IsHide&&(i.IsHide=!1,o.GetParentsByID(n,i.parent))}},o.ProductCategories_Get=()=>e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.ProductCategories}),o.ProductCategories_ByUserLogin=function(){let n=u.defer();return e.PostMethod("/Users/GetProductCategories/").then(t=>t.StatusCode==204?(t.Is204=!0,t.Data=[],n.resolve(t)):n.resolve(t)).catch(t=>n.reject(t)),n.promise},o.StoreTree_Read=n=>{let t=u.defer(),i=n=>{var r=[],u=_.groupBy(n,"AreaID"),i,t;for(i in u)t={},t.id="G_"+i,t.text=u[i][0].AreaName,t.parent="#",t.IsSaleStore=!0,t.ProvinceIDs=[],t.DistrictIDs=[],u[i].forEach(n=>{var i=n;i.id=n.StoreID;i.text=n.StoreName;i.parent="G_"+n.AreaID.toString();i.ProvinceID=n.ProvinceID;i.DistrictID=n.DistrictID;i.ProvinceIDs=[];i.DistrictIDs=[];r.push(i);t.ProvinceIDs.push(n.ProvinceID);t.DistrictIDs.push(n.DistrictID)}),r.push(t);return r};return n?(o.Stores_Get().then(n=>{n.Data=i(n.Data.filter(n=>n.IsActived)),t.resolve(n)}).catch(n=>{t.reject(n)}),t.promise):(o.UserStores_Get().then(n=>{n.Data=i(n.Data),t.resolve(n)}).catch(n=>{t.reject(n)}),t.promise)},o.DeliveryFees_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.DeliveryFee})},o.DeliveryTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.DeliveryType})},o.Companies_Get=function(){let n=ApiEndPoint.CompaniesResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Company})},o.CurrencyUnit_Get=function(){let n=ApiEndPoint.CurrencyUnitsResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.CurrencyUnit})},o.InvoiceType_Get=function(){let n=ApiEndPoint.ACC_InvoiceTypesResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.InvoiceType})},o.ShippingStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.ShippingStatus})},o.BusinessType_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.BusinessType})},o.TaxValue_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.TaxValue})},o.Accounts_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.Account})},o};DataFactory.$inject=["$rootScope","$localstorage","$timeout","UtilFactory","$q","$http","CommonFactory"];